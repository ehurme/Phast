---
title: "BORIS_ACC"
output: html_document
date: "2023-06-15"
---

```{r}
library(pacman)
p_load(lubridate, data.table, tidyverse, dplyr, accelerateR, roll, randomForest)
```

# load acceleration data
```{r}
bolt <- fread("../../../../Dropbox/MPI/Phyllostomus/Fieldwork/Data/FlightCage/PH_FC_01.csv")
bolt <- bolt[,1:5]
# bolt <- fread("../../../../ownCloud - ehurme@ab.mpg.de@owncloud.gwdg.de/Firetail/Phyllostomushastatus/Model_tag_PH_FC_01/")
heart <- fread("../../../../Dropbox/MPI/Phyllostomus/Fieldwork/Data/FlightCage/PH_FC_02.csv")
heart <- heart[,1:5]
star <- fread("../../../../Dropbox/MPI/Phyllostomus/Fieldwork/Data/FlightCage/PH_FC_03.csv")
star <- star[,1:5]
# rm(star)
moon <- fread("../../../../Dropbox/MPI/Phyllostomus/Fieldwork/Data/FlightCage/PH_FC_04.csv")
moon <- moon[,1:5]


bolt$time <- dmy_hms(bolt$timestamp)
# bolt$id <- "bolt"
# bolt$sampling <- 50
heart$time <- dmy_hms(heart$timestamp)

star$time <- dmy_hms(star$timestamp)

moon$time <- dmy_hms(moon$timestamp)

```

# OBDA and VeDBA
```{r}
vedba <- function(acc){
  acc$x0 <- roll_mean(acc$x, width = 25, na_restore = TRUE)
  acc$y0 <- roll_mean(acc$y, width = 25, na_restore = TRUE)
  acc$z0 <- roll_mean(acc$z, width = 25, na_restore = TRUE)
  
  acc$x1 <- acc$x - acc$x0
  acc$y1 <- acc$y - acc$y0
  acc$z1 <- acc$z - acc$z0
  
  acc$ODBA <- abs(acc$x1) + abs(acc$y1) + abs(acc$z1)
  acc$VeDBA <- sqrt((acc$x1)^2 + (acc$y1)^2 + (acc$z1)^2)
  return(acc)
}


```


```{r}
bolt <- vedba(bolt)
heart <- vedba(heart)
moon <- vedba(moon)
star <- vedba(star)

bolt$ODBA[1:100000] %>% plot(type = "l")
with(bolt[1:100000], plot(ODBA, VeDBA))
```

#time of acc
```{r}
hour(bolt$time[bolt$ODBA > 1] - 5*3600) %>% hist

```


# load video data
```{r}
path <- "../../../../Dropbox/MPI/Dechmann_Lab/Johannes Bernecker/boris_files/ExportedData/updated/"
files <- list.files(path, pattern = ".csv")
i = 1
for(i in 1:(length(files))){
  a <- data.table::fread(paste0(path, files[i]), header = TRUE)
  # which bats are active?
  paste0(a$Behavior, a$Subject) %>% table
  a <- a[order(a$Subject, a$Behavior, a$Time),]
  a_mlt <- data.frame(start = a$Time[a$Status == "START"],
                            stop = a$Time[a$Status == "STOP"],
                            behavior = a$Behavior[a$Status == "START"],
                            subject = a$Subject[a$Status == "START"])
  p <- ggplot(a_mlt, aes(x = start, xend = stop, y = behavior, yend = behavior, 
                          col = behavior, group = subject))+
    geom_segment(size = 2)+facet_wrap(~subject)+ggtitle(files[i])
  print(p)
}

# 050422_1_2
```

## 05/04/22 
### Part 1
### videos created
```{r}
video_files_5.1 <- list.files(path = "H:/Panama22/FlightCageBocas/Video/050422/Part1/", pattern = ".MP4", full.names = TRUE)

video_time_5.1 <- base::file.info(video_files_5.1)$mtime

tz(video_time_5.1) <- "UTC"


```

#### acc check function
```{r}
acc_check <- function(video_time, video_duration, 
                      acc, video, 
                      start, end, buffer = 1000, time_shift, acc_adj, thick = FALSE){
  acc_date <- acc %>% filter(time > start & time < end)
  idx <- seq(1, nrow(acc_date), by = 100)
  acc_date_thin <- acc_date[idx,]
  
  video_mlt <- data.frame(start = video$Time[video$Status == "START"]+video_time-video_duration,
                               stop = video$Time[video$Status == "STOP"]+video_time-video_duration,
                               behavior = video$Behavior[video$Status == "START"] %>% factor,
                               z = video$Behavior[video$Status == "START"] %>% factor %>% as.numeric)
  p <- ggplot(video_mlt, aes(x = start, # "2022-04-07 00:09:28 CEST"
                             xend = stop, 
                             y = z+1, yend = z+1, col = factor(behavior)))+
    ylim(c(-4,8))+
    xlim(c(min(video_mlt$start)-buffer, max(video_mlt$stop)+buffer))+
    geom_segment(size = 2)+
    # geom_line(data = acc_date_thin, aes(x = time-time_shift+acc_adj, y = z),
    #           col = 1, inherit.aes = FALSE)+ 
    # geom_line(data = acc_date_thin, aes(x = time-time_shift+acc_adj, y = y), col = 2, inherit.aes = FALSE)+
    geom_line(data = acc_date_thin, aes(x = time-time_shift+acc_adj, y = x), col = 3, inherit.aes = FALSE)+
    geom_line(data = acc_date_thin, aes(x = time-time_shift+acc_adj, y = ODBA), col = 4, inherit.aes = FALSE)+
    geom_line(data = acc_date_thin, aes(x = time-time_shift+acc_adj, y = VeDBA), col = 5, inherit.aes = FALSE)
  print(p)
  
  if(thick == TRUE){
    p_thick <- ggplot(video_mlt, aes(x = start, 
                             xend = stop, 
                             y = z+1, yend = z+1, col = factor(behavior)))+
    ylim(c(-4,8))+
    xlim(c(min(video_mlt$start)-buffer, max(video_mlt$stop)+buffer))+
    geom_segment(size = 2)+
    # geom_line(data = acc_date, aes(x = time-time_shift, y = z), col = 1, inherit.aes = FALSE)+
    # geom_line(data = acc_date_thin, aes(x = time-time_shift, y = y), col = 2, inherit.aes = FALSE)+
    geom_line(data = acc_date, aes(x = time-time_shift+acc_adj, y = x), col = 1, inherit.aes = FALSE)+
      geom_line(data = acc_date, aes(x = time-time_shift+acc_adj, y = VeDBA), col = 4, inherit.aes = FALSE)
    print(p_thick)
  }
}
```

#### acc add behavior
```{r}
acc_check(video_time = video_time_5.1[3],  
          video_duration = video_duration_05.1.3,
          acc = star, video = a05.1.3_star, 
          start = ymd("2022-04-06"), end = ymd("2022-04-08"),
          buffer = 100,
          time_shift = -2*3600, acc_adj = -5, thick = TRUE)

# acc <- star
# acc$behavior <- NA

acc_add_behavior <- function(video_time, 
                             video_duration,
                             acc, video, 
                             time_shift, acc_adj){
  acc$video_time <- acc$time- time_shift + acc_adj
  video_mlt <- data.frame(start = video$Time[video$Status == "START"]+video_time-video_duration,
                               stop = video$Time[video$Status == "STOP"]+video_time-video_duration,
                               behavior = video$Behavior[video$Status == "START"] %>% factor,
                               z = video$Behavior[video$Status == "START"] %>% factor %>% as.numeric)
  i = 1
  for(i in 1:nrow(video_mlt)){
    idx <- which(acc$video_time > video_mlt$start[i] & acc$video_time < video_mlt$stop[i])
    acc$behavior[idx] <- as.character(video_mlt$behavior[i])
  }
  return(acc)
}
```

```{r}
moon$behavior <- NA
star$behavior <- NA
heart$behavior <- NA
bolt$behavior <- NA

acc_add_behavior(video_time = video_time_5.1[3],  
              video_duration = video_duration_05.1.3,
              acc = star, video = a05.1.3_star,  
              time_shift = -2*3600, acc_adj = -5)

```

### Part 1.1
```{r}
a05.1.1 <- data.table::fread("../../../../Dropbox/MPI/Dechmann_Lab/Johannes Bernecker/boris_files/ExportedData/updated/050422_1_1.csv", header = TRUE)
# paste0(a05.1.1$Behavior, a05.1.1$Subject) %>% table
video_duration_05.1.1 <- a05.1.1$`Total length`[1]

a05.1.1 <- a05.1.1[order(a05.1.1$Subject, a05.1.1$Behavior, a05.1.1$Time),]
a05.1.1_mlt <- data.frame(start = a05.1.1$Time[a05.1.1$Status == "START"],
                          stop = a05.1.1$Time[a05.1.1$Status == "STOP"],
                          behavior = a05.1.1$Behavior[a05.1.1$Status == "START"],
                          subject = a05.1.1$Subject[a05.1.1$Status == "START"])
ggplot(a05.1.1_mlt, aes(x = start, xend = stop, y = behavior, yend = behavior, 
                        col = behavior, group = subject))+
  geom_segment(size = 2)+facet_wrap(~subject)


a05.1.1_bolt <- a05.1.1 %>% filter(Subject == "light bolt")
a05.1.1_moon <- a05.1.1 %>% filter(Subject == "moon")
a05.1.1_heart <- a05.1.1 %>% filter(Subject == "heart")
a05.1.1_star <- a05.1.1 %>% filter(Subject == "star")

```

#### look at moon
```{r}
acc_check(video_time = video_time_5.1[1], 
          video_duration = video_duration_05.1.1,
          acc = moon, video = a05.1.1_moon, 
          start = ymd("2022-04-06"), end = ymd("2022-04-08"),
          buffer = 100,
          time_shift = -2*3600, acc_adj = -5, thick = FALSE)

```
##### add acc behav
```{r}
moon <- acc_add_behavior(video_time = video_time_5.1[1],  
              video_duration = video_duration_05.1.1,
              acc = moon, video = a05.1.1_moon,  
              time_shift = -2*3600, acc_adj = -5)
```


#### look at star

```{r}
acc_check(video_time = video_time_5.1[1], 
          video_duration = video_duration_05.1.1,
          acc = star, video = a05.1.1_star, 
          start = ymd("2022-04-06"), end = ymd("2022-04-08"),
          buffer = 100,
          time_shift = -2*3600, acc_adj = 0, thick = FALSE)
```
##### add acc behav
```{r}
star <- acc_add_behavior(video_time = video_time_5.1[1],  
              video_duration = video_duration_05.1.1,
              acc = star, video = a05.1.1_star,  
              time_shift = -2*3600, acc_adj = -5)
```


#### look at heart
```{r}
acc_check(video_time = video_time_5.1[1], 
          video_duration = video_duration_05.1.1,
          acc = heart, video = a05.1.1_heart, 
          start = ymd("2022-04-06"), end = ymd("2022-04-08"),
          buffer = 100,
          time_shift = -2*3600, acc_adj = -5, thick = FALSE)
```

##### add acc behav
```{r}
heart <- acc_add_behavior(video_time = video_time_5.1[1],  
              video_duration = video_duration_05.1.1,
              acc = heart, video = a05.1.1_heart,  
              time_shift = -2*3600, acc_adj = -5)
```


#### look at bolt
```{r}
acc_check(video_time = video_time_5.1[1], 
          video_duration = video_duration_05.1.1,
          acc = bolt, video = a05.1.1_bolt, 
          start = ymd("2022-04-06"), end = ymd("2022-04-08"),
          buffer = 100,
          time_shift = -2*3600, acc_adj = 0, thick = FALSE)
```

##### add acc behav
```{r}
bolt <- acc_add_behavior(video_time = video_time_5.1[1],  
              video_duration = video_duration_05.1.1,
              acc = bolt, video = a05.1.1_bolt,  
              time_shift = -2*3600, acc_adj = -5)
```

### Part 1.2
```{r}
a05.1.2 <- data.table::fread("../../../../Dropbox/MPI/Dechmann_Lab/Johannes Bernecker/boris_files/ExportedData/updated/050422_1_2.csv", header = TRUE)
paste0(a05.1.2$Behavior, a05.1.2$Subject) %>% table
video_duration_05.1.2 <- a05.1.2$`Total length`[1]

a05.1.2 <- a05.1.2[order(a05.1.2$Subject, a05.1.2$Behavior, a05.1.2$Time),]
a05.1.2_mlt <- data.frame(start = a05.1.2$Time[a05.1.2$Status == "START"],
                          stop = a05.1.2$Time[a05.1.2$Status == "STOP"],
                          behavior = a05.1.2$Behavior[a05.1.2$Status == "START"],
                          subject = a05.1.2$Subject[a05.1.2$Status == "START"])
ggplot(a05.1.2_mlt, aes(x = start, xend = stop, y = behavior, yend = behavior, 
                        col = behavior, group = subject))+
  geom_segment(size = 2)+facet_wrap(~subject)

a05.1.2_bolt <- a05.1.2 %>% filter(Subject == "light bolt")
a05.1.2_moon <- a05.1.2 %>% filter(Subject == "moon")
a05.1.2_heart <- a05.1.2 %>% filter(Subject == "heart")
a05.1.2_star <- a05.1.2 %>% filter(Subject == "star")


```

#### look at moon
```{r}
acc_check(video_time = video_time_5.1[2],  
          video_duration = video_duration_05.1.2,
          acc = moon, video = a05.1.2_moon, 
          start = ymd("2022-04-06"), end = ymd("2022-04-08"),
          buffer = 1000,
          time_shift = -2*3600, acc_adj = -5, thick = FALSE)
```

##### add acc behav
```{r}
moon <- acc_add_behavior(video_time = video_time_5.1[1],  
              video_duration = video_duration_05.1.1,
              acc = moon, video = a05.1.1_moon,  
              time_shift = -2*3600, acc_adj = -5)
```

#### look at star
```{r}
acc_check(video_time = video_time_5.1[2],  
          video_duration = video_duration_05.1.2,
          acc = star, video = a05.1.2_star, 
          start = ymd("2022-04-06"), end = ymd("2022-04-08"),
          buffer = 10,
          time_shift = -2*3600, acc_adj = -5, thick = FALSE)
```

##### add acc behav
```{r}
star <- acc_add_behavior(video_time = video_time_5.1[2],  
              video_duration = video_duration_05.1.2,
              acc = star, video = a05.1.2_star,  
              time_shift = -2*3600, acc_adj = -5)
```

#### look at heart
```{r}
acc_check(video_time = video_time_5.1[2],  
          video_duration = video_duration_05.1.2,
          acc = heart, video = a05.1.2_heart, 
          start = ymd("2022-04-06"), end = ymd("2022-04-08"),
          buffer = 1000,
          time_shift = -2*3600, acc_adj = 0, thick = TRUE)
```

##### add acc behav
```{r}
heart <- acc_add_behavior(video_time = video_time_5.1[2],  
              video_duration = video_duration_05.1.2,
              acc = heart, video = a05.1.2_heart,  
              time_shift = -2*3600, acc_adj = -5)
```

#### look at bolt
```{r}
acc_check(video_time = video_time_5.1[2],  
          video_duration = video_duration_05.1.2,
          acc = bolt, video = a05.1.2_bolt, 
          start = ymd("2022-04-06"), end = ymd("2022-04-08"),
          buffer = -100,
          time_shift = -2*3600, acc_adj = 0, thick = TRUE)
```
##### add acc behav
```{r}
bolt <- acc_add_behavior(video_time = video_time_5.1[2],  
              video_duration = video_duration_05.1.2,
              acc = bolt, video = a05.1.2_bolt,  
              time_shift = -2*3600, acc_adj = -5)
```

### Part 1.3
```{r}

# video_created <- ymd_hm("2022-04-07 1:11")
video_created <- videos_created[3]
a05.1.3 <- data.table::fread("../../../../Dropbox/MPI/Dechmann_Lab/Johannes Bernecker/boris_files/ExportedData/050422_1_3.csv", header = TRUE)

paste0(a05.1.3$Behavior, a05.1.3$Subject) %>% table
video_duration_05.1.3 <- a05.1.3$`Total length`[1]

a05.1.3 <- a05.1.3[order(a05.1.3$Subject, a05.1.3$Behavior, a05.1.3$Time),]
a05.1.3_mlt <- data.frame(start = a05.1.3$Time[a05.1.3$Status == "START"],
                          stop = a05.1.3$Time[a05.1.3$Status == "STOP"],
                          behavior = a05.1.3$Behavior[a05.1.3$Status == "START"],
                          subject = a05.1.3$Subject[a05.1.3$Status == "START"])
ggplot(a05.1.3_mlt, aes(x = start, xend = stop, y = behavior, yend = behavior, 
                        col = behavior, group = subject))+
  geom_segment(size = 2)+facet_wrap(~subject)


a05.1.3_bolt <- a05.1.3 %>% filter(Subject == "light bolt")
a05.1.3_moon <- a05.1.3 %>% filter(Subject == "moon")
a05.1.3_heart <- a05.1.3 %>% filter(Subject == "heart")
a05.1.3_star <- a05.1.3 %>% filter(Subject == "star")
```

#### look at moon

```{r}
acc_check(video_time = video_time_5.1[3],  
          video_duration = video_duration_05.1.3,
          acc = moon, video = a05.1.3_moon, 
          start = ymd("2022-04-06"), end = ymd("2022-04-08"),
          buffer = 100,
          time_shift = -2*3600, acc_adj = -5, thick = TRUE)
```

##### add acc behav
```{r}
# moon <- acc_add_behavior(video_time = video_time_5.1[3],  
#               video_duration = video_duration_05.1.3,
#               acc = moon, video = a05.1.3_moon,  
#               time_shift = -2*3600, acc_adj = -5)
```

#### look at star
```{r}
acc_check(video_time = video_time_5.1[3],  
          video_duration = video_duration_05.1.3,
          acc = star, video = a05.1.3_star, 
          start = ymd("2022-04-06"), end = ymd("2022-04-08"),
          buffer = 100,
          time_shift = -2*3600, acc_adj = -5, thick = TRUE)
```

##### add acc behav
```{r}
star <- acc_add_behavior(video_time = video_time_5.1[3],
              video_duration = video_duration_05.1.3,
              acc = star, video = a05.1.3_star,
              time_shift = -2*3600, acc_adj = -5)
```

#### look at heart
```{r}
acc_check(video_time = video_time_5.1[3],  
          video_duration = video_duration_05.1.3,
          acc = heart, video = a05.1.3_heart, 
          start = ymd("2022-04-06"), end = ymd("2022-04-08"),
          buffer = 10,
          time_shift = -2*3600, acc_adj = -5, thick = TRUE)
```

##### add acc behav
```{r}
heart <- acc_add_behavior(video_time = video_time_5.1[3],
              video_duration = video_duration_05.1.3,
              acc = heart, video = a05.1.3_heart,
              time_shift = -2*3600, acc_adj = -5)
```

#### look at bolt
```{r}
acc_check(video_time = video_time_5.1[3],  
          video_duration = video_duration_05.1.3,
          acc = bolt, video = a05.1.3_bolt, 
          start = ymd("2022-04-06"), end = ymd("2022-04-08"),
          buffer = 100,
          time_shift = -2*3600, acc_adj = -5, thick = TRUE)
```

##### add acc behav
```{r}
# bolt <- acc_add_behavior(video_time = video_time_5.1[3],  
#               video_duration = video_duration_05.1.3,
#               acc = moon, video = a05.1.3_bolt,  
#               time_shift = -2*3600, acc_adj = -5)
```

### Part 2
### videos created
```{r}
video_files_5.2 <- list.files(path = "H:/Panama22/FlightCageBocas/Video/050422/Part2/", pattern = ".MP4", full.names = TRUE)

video_time_5.2 <- base::file.info(video_files_5.2)$mtime

tz(video_time_5.2) <- "UTC"
```
### Part 2.1
```{r}
a05.2.1 <- data.table::fread("../../../../Dropbox/MPI/Dechmann_Lab/Johannes Bernecker/boris_files/ExportedData/updated/050422_2_1.csv", header = TRUE)
# paste0(a05.1.1$Behavior, a05.1.1$Subject) %>% table
video_duration_05.2.1 <- a05.2.1$`Total length`[1]

a05.2.1 <- a05.2.1[order(a05.2.1$Subject, a05.2.1$Behavior, a05.2.1$Time),]
a05.2.1_mlt <- data.frame(start = a05.2.1$Time[a05.2.1$Status == "START"],
                          stop = a05.2.1$Time[a05.2.1$Status == "STOP"],
                          behavior = a05.2.1$Behavior[a05.2.1$Status == "START"],
                          subject = a05.2.1$Subject[a05.2.1$Status == "START"])
ggplot(a05.2.1_mlt, aes(x = start, xend = stop, y = behavior, yend = behavior, 
                        col = behavior, group = subject))+
  geom_segment(size = 2)+facet_wrap(~subject)


a05.2.1_bolt <- a05.2.1 %>% filter(Subject == "light bolt")
a05.2.1_moon <- a05.2.1 %>% filter(Subject == "moon")
a05.2.1_heart <- a05.2.1 %>% filter(Subject == "heart")
a05.2.1_star <- a05.2.1 %>% filter(Subject == "star")

```

#### look at moon
```{r}
acc_check(video_time = video_time_5.2[1],
          video_duration = video_duration_05.2.1,
          acc = moon, video = a05.2.1_moon, 
          start = ymd("2022-04-06"), end = ymd("2022-04-08"),
          buffer = 50,
          time_shift = -2*3600, acc_adj = -5, thick = FALSE)
```

##### add acc behav
```{r}
moon <- acc_add_behavior(video_time = video_time_5.2[1],
              video_duration = video_duration_05.2.1,
              acc = moon, video = a05.2.1_moon,
              time_shift = -2*3600, acc_adj = -5)
```

#### look at star
```{r}
acc_check(video_time = video_time_5.2[1],
          video_duration = video_duration_05.2.1,
          acc = star, video = a05.2.1_star, 
          start = ymd("2022-04-06"), end = ymd("2022-04-08"),
          buffer = 50,
          time_shift = -2*3600, acc_adj = -5, thick = FALSE)
```
##### add acc behav
```{r}
star <- acc_add_behavior(video_time = video_time_5.2[1],
              video_duration = video_duration_05.2.1,
              acc = star, video = a05.2.1_star,
              time_shift = -2*3600, acc_adj = -5)
```


#### look at heart
```{r}
acc_check(video_time = video_time_5.2[1],
          video_duration = video_duration_05.2.1,
          acc = heart, video = a05.2.1_heart, 
          start = ymd("2022-04-06"), end = ymd("2022-04-08"),
          buffer = 50,
          time_shift = -2*3600, acc_adj = -5, thick = FALSE)
```
##### add acc behav
```{r}
heart<- acc_add_behavior(video_time = video_time_5.2[1],
              video_duration = video_duration_05.2.1,
              acc = heart, video = a05.2.1_heart,
              time_shift = -2*3600, acc_adj = -5)
```


#### look at bolt
```{r}
acc_check(video_time = video_time_5.2[1],
          video_duration = video_duration_05.2.1,
          acc = bolt, video = a05.2.1_bolt, 
          start = ymd("2022-04-06"), end = ymd("2022-04-08"),
          buffer = -500,
          time_shift = -2*3600, acc_adj = -5, thick = FALSE)
```

##### add acc behav
```{r}
bolt<- acc_add_behavior(video_time = video_time_5.2[1],
              video_duration = video_duration_05.2.1,
              acc = bolt, video = a05.2.1_bolt,
              time_shift = -2*3600, acc_adj = -5)
```


## 06/04/22 
### Part 1
#### videos created
```{r}
video_files_6.1 <- list.files(path = "H:/Panama22/FlightCageBocas/Video/060422/Part1/", pattern = ".MP4", full.names = TRUE)

video_time_6.1 <- base::file.info(video_files_6.1)$mtime

tz(video_time_6.1) <- "UTC"
```
### Part 1.1
```{r}

a06.1.1 <- data.table::fread("../../../../Dropbox/MPI/Dechmann_Lab/Johannes Bernecker/boris_files/ExportedData/updated/060422_1_1.csv", header = TRUE)
paste0(a06.1.1$Behavior, a06.1.1$Subject) %>% table
video_duration_06.1.1 <- a06.1.1$`Total length`[1]

a06.1.1 <- a06.1.1[order(a06.1.1$Subject, a06.1.1$Behavior, a06.1.1$Time),]
a06.1.1_mlt <- data.frame(start = a06.1.1$Time[a06.1.1$Status == "START"],
                          stop = a06.1.1$Time[a06.1.1$Status == "STOP"],
                          behavior = a06.1.1$Behavior[a06.1.1$Status == "START"],
                          subject = a06.1.1$Subject[a06.1.1$Status == "START"])
ggplot(a06.1.1_mlt, aes(x = start, xend = stop, y = behavior, yend = behavior, 
                        col = behavior, group = subject))+
  geom_segment(size = 2)+facet_wrap(~subject)


a06.1.1_bolt <- a06.1.1 %>% filter(Subject == "light bolt")
a06.1.1_moon <- a06.1.1 %>% filter(Subject == "moon")
a06.1.1_heart <- a06.1.1 %>% filter(Subject == "heart")
a06.1.1_star <- a06.1.1 %>% filter(Subject == "star")

```

#### look at moon
```{r}
acc_check(video_time = video_time_6.1[1],
          video_duration = video_duration_06.1.1,
          acc = moon, video = a06.1.1_moon, 
          start = ymd("2022-04-06"), end = ymd("2022-04-08"),
          buffer = 500,
          time_shift = -2*3600, acc_adj = -5, thick = TRUE)
```

##### add acc behav
```{r}
moon <- acc_add_behavior(video_time = video_time_6.1[1],
              video_duration = video_duration_06.1.1,
              acc = moon, video = a06.1.1_moon,
              time_shift = -2*3600, acc_adj = -5)
```


#### look at star
```{r}
acc_check(video_time = video_time_6.1[1],
          video_duration = video_duration_06.1.1,
          acc = star, video = a06.1.1_star, 
          start = ymd("2022-04-06"), end = ymd("2022-04-08"),
          buffer = 500,
          time_shift = -2*3600, acc_adj = -5, thick = FALSE)
```
##### add acc behav
```{r}
star <- acc_add_behavior(video_time = video_time_6.1[1],
              video_duration = video_duration_06.1.1,
              acc = star, video = a06.1.1_star,
              time_shift = -2*3600, acc_adj = -5)
```

#### look at heart
```{r}
acc_check(video_time = video_time_6.1[1],
          video_duration = video_duration_06.1.1,
          acc = heart, video = a06.1.1_heart, 
          start = ymd("2022-04-06"), end = ymd("2022-04-08"),
          buffer = 500,
          time_shift = -2*3600, acc_adj = -5, thick = FALSE)
```

##### add acc behav
```{r}
heart <- acc_add_behavior(video_time = video_time_6.1[1],
              video_duration = video_duration_06.1.1,
              acc = heart, video = a06.1.1_heart,
              time_shift = -2*3600, acc_adj = -5)
```

#### look at bolt
```{r}
acc_check(video_time = video_time_6.1[1],
          video_duration = video_duration_06.1.1,
          acc = bolt, video = a06.1.1_bolt, 
          start = ymd("2022-04-06"), end = ymd("2022-04-08"),
          buffer = 500,
          time_shift = -2*3600, acc_adj = -5, thick = FALSE)
```

##### add acc behav
```{r}
bolt <- acc_add_behavior(video_time = video_time_6.1[1],
              video_duration = video_duration_06.1.1,
              acc = bolt, video = a06.1.1_bolt,
              time_shift = -2*3600, acc_adj = -5)
``` 

### Part 2
#### videos created
```{r}
video_files_6.2 <- list.files(path = "H:/Panama22/FlightCageBocas/Video/060422/Part2/", pattern = ".MP4", full.names = TRUE)

video_time_6.2 <- base::file.info(video_files_6.2)$mtime

tz(video_time_6.2) <- "UTC"
```
### Part 2.1
```{r}
a06.2.1 <- data.table::fread("../../../../Dropbox/MPI/Dechmann_Lab/Johannes Bernecker/boris_files/ExportedData/updated/060422_2_1.csv", header = TRUE)
paste0(a06.2.1$Behavior, a06.2.1$Subject) %>% table
video_duration_06.2.1 <- a06.2.1$`Total length`[1]

a06.2.1 <- a06.2.1[order(a06.2.1$Subject, a06.2.1$Behavior, a06.2.1$Time),]
a06.2.1_mlt <- data.frame(start = a06.2.1$Time[a06.2.1$Status == "START"],
                          stop = a06.2.1$Time[a06.2.1$Status == "STOP"],
                          behavior = a06.2.1$Behavior[a06.2.1$Status == "START"],
                          subject = a06.2.1$Subject[a06.2.1$Status == "START"])
ggplot(a06.2.1_mlt, aes(x = start, xend = stop, y = behavior, yend = behavior, 
                        col = behavior, group = subject))+
  geom_segment(size = 2)+facet_wrap(~subject)


a06.2.1_bolt <- a06.2.1 %>% filter(Subject == "light bolt")
a06.2.1_moon <- a06.2.1 %>% filter(Subject == "moon")
a06.2.1_heart <- a06.2.1 %>% filter(Subject == "heart")
a06.2.1_star <- a06.2.1 %>% filter(Subject == "star")
```

#### look at moon
```{r}
acc_check(video_time = video_time_6.2[1],
          video_duration = video_duration_06.2.1,
          acc = moon, video = a06.2.1_moon, 
          start = ymd("2022-04-06"), end = ymd("2022-04-08"),
          buffer = 100,
          time_shift = -2*3600, acc_adj = -5, thick = FALSE)
```

##### add acc behav
```{r}
moon <- acc_add_behavior(video_time = video_time_6.2[1],
              video_duration = video_duration_06.2.1,
              acc = moon, video = a06.2.1_moon,
              time_shift = -2*3600, acc_adj = -5)
```

#### look at star
```{r}
acc_check(video_time = video_time_6.2[1],
          video_duration = video_duration_06.2.1,
          acc = star, video = a06.2.1_star, 
          start = ymd("2022-04-06"), end = ymd("2022-04-08"),
          buffer = 500,
          time_shift = -2*3600, acc_adj = -5, thick = FALSE)
```

##### add acc behav
```{r}
star <- acc_add_behavior(video_time = video_time_6.2[1],
              video_duration = video_duration_06.2.1,
              acc = star, video = a06.2.1_star,
              time_shift = -2*3600, acc_adj = -5)
```

#### look at heart
```{r}
acc_check(video_time = video_time_6.2[1],
          video_duration = video_duration_06.2.1,
          acc = heart, video = a06.2.1_heart, 
          start = ymd("2022-04-06"), end = ymd("2022-04-08"),
          buffer = 500,
          time_shift = -2*3600, acc_adj = -5, thick = FALSE)
```

##### add acc behav
```{r}
heart <- acc_add_behavior(video_time = video_time_6.2[1],
              video_duration = video_duration_06.2.1,
              acc = heart, video = a06.2.1_heart,
              time_shift = -2*3600, acc_adj = -5)
```

#### look at bolt
```{r}
acc_check(video_time = video_time_6.2[1],
          video_duration = video_duration_06.2.1,
          acc = bolt, video = a06.2.1_bolt, 
          start = ymd("2022-04-06"), end = ymd("2022-04-08"),
          buffer = 500,
          time_shift = -2*3600, acc_adj = -5, thick = FALSE)
```

##### add acc behav
```{r}
bolt <- acc_add_behavior(video_time = video_time_6.2[1],
              video_duration = video_duration_06.2.1,
              acc = bolt, video = a06.2.1_bolt,
              time_shift = -2*3600, acc_adj = -5)
```

### Part 3
#### videos created
```{r}
video_files_6.3 <- list.files(path = "H:/Panama22/FlightCageBocas/Video/060422/Part3/", pattern = ".MP4", full.names = TRUE)

video_time_6.3 <- base::file.info(video_files_6.3)$mtime

tz(video_time_6.3) <- "UTC"
```
### Part 3.1
```{r}
a06.3.1 <- data.table::fread("../../../../Dropbox/MPI/Dechmann_Lab/Johannes Bernecker/boris_files/ExportedData/updated/060422_3_1.csv", header = TRUE)
paste0(a06.3.1$Behavior, a06.3.1$Subject) %>% table
video_duration_06.3.1 <- a06.3.1$`Total length`[1]

a06.3.1 <- a06.3.1[order(a06.3.1$Subject, a06.3.1$Behavior, a06.3.1$Time),]
a06.3.1_mlt <- data.frame(start = a06.3.1$Time[a06.3.1$Status == "START"],
                          stop = a06.3.1$Time[a06.3.1$Status == "STOP"],
                          behavior = a06.3.1$Behavior[a06.3.1$Status == "START"],
                          subject = a06.3.1$Subject[a06.3.1$Status == "START"])
ggplot(a06.3.1_mlt, aes(x = start, xend = stop, y = behavior, yend = behavior, 
                        col = behavior, group = subject))+
  geom_segment(size = 2)+facet_wrap(~subject)


a06.3.1_bolt <- a06.3.1 %>% filter(Subject == "light bolt")
a06.3.1_moon <- a06.3.1 %>% filter(Subject == "moon")
a06.3.1_heart <- a06.3.1 %>% filter(Subject == "heart")
a06.3.1_star <- a06.3.1 %>% filter(Subject == "star")

```

#### look at moon
```{r}
acc_check(video_time = video_time_6.3[1],
          video_duration = video_duration_06.3.1,
          acc = moon, video = a06.3.1_moon, 
          start = ymd("2022-04-06"), end = ymd("2022-04-08"),
          buffer = 500,
          time_shift = -2*3600, acc_adj = -5, thick = FALSE)
```

##### add acc behav
```{r}
moon <- acc_add_behavior(video_time = video_time_6.3[1],
              video_duration = video_duration_06.3.1,
              acc = moon, video = a06.3.1_moon,
              time_shift = -2*3600, acc_adj = -5)
```

#### look at star
```{r}
acc_check(video_time = video_time_6.3[1],
          video_duration = video_duration_06.3.1,
          acc = star, video = a06.3.1_star, 
          start = ymd("2022-04-06"), end = ymd("2022-04-08"),
          buffer = 500,
          time_shift = -2*3600, acc_adj = -5, thick = FALSE)
```

##### add acc behav
```{r}
star <- acc_add_behavior(video_time = video_time_6.3[1],
              video_duration = video_duration_06.3.1,
              acc = star, video = a06.3.1_star,
              time_shift = -2*3600, acc_adj = -5)
```

#### look at heart
```{r}
acc_check(video_time = video_time_6.3[1],
          video_duration = video_duration_06.3.1,
          acc = heart, video = a06.3.1_heart, 
          start = ymd("2022-04-06"), end = ymd("2022-04-08"),
          buffer = 500,
          time_shift = -2*3600, acc_adj = -5, thick = FALSE)
```

##### add acc behav
```{r}
heart <- acc_add_behavior(video_time = video_time_6.3[1],
              video_duration = video_duration_06.3.1,
              acc = heart, video = a06.3.1_heart,
              time_shift = -2*3600, acc_adj = -5)
```

#### look at bolt
```{r}
acc_check(video_time = video_time_6.3[1],
          video_duration = video_duration_06.3.1,
          acc = bolt, video = a06.3.1_bolt, 
          start = ymd("2022-04-06"), end = ymd("2022-04-08"),
          buffer = 100,
          time_shift = -2*3600, acc_adj = -5, thick = FALSE)
```

##### add acc behav
```{r}
bolt <- acc_add_behavior(video_time = video_time_6.3[1],
              video_duration = video_duration_06.3.1,
              acc = bolt, video = a06.3.1_bolt,
              time_shift = -2*3600, acc_adj = -5)
```

## 07/4/22
### Part 3
### videos created
```{r}
video_files_7.3 <- list.files(path = "H:/Panama22/FlightCageBocas/Video/070422/Part3/", pattern = ".MP4", full.names = TRUE)

video_time_7.3 <- base::file.info(video_files_7.3)$mtime

tz(video_time_7.3) <- "UTC"
```
### Part 3.2
```{r}
a07.3.2 <- data.table::fread("../../../../Dropbox/MPI/Dechmann_Lab/Johannes Bernecker/boris_files/ExportedData/updated/070422_3_2.csv", header = TRUE)
paste0(a07.3.2$Behavior, a07.3.2$Subject) %>% table
video_duration_07.3.2 <- a07.3.2$`Total length`[1]

a07.3.2 <- a07.3.2[order(a07.3.2$Subject, a07.3.2$Behavior, a07.3.2$Time),]
a07.3.2_mlt <- data.frame(start = a07.3.2$Time[a07.3.2$Status == "START"],
                          stop = a07.3.2$Time[a07.3.2$Status == "STOP"],
                          behavior = a07.3.2$Behavior[a07.3.2$Status == "START"],
                          subject = a07.3.2$Subject[a07.3.2$Status == "START"])
ggplot(a07.3.2_mlt, aes(x = start, xend = stop, y = behavior, yend = behavior, 
                        col = behavior, group = subject))+
  geom_segment(size = 2)+facet_wrap(~subject)


a07.3.2_bolt <- a07.3.2 %>% filter(Subject == "light bolt")
a07.3.2_moon <- a07.3.2 %>% filter(Subject == "moon")
a07.3.2_heart <- a07.3.2 %>% filter(Subject == "heart")
a07.3.2_star <- a07.3.2 %>% filter(Subject == "star")

```

#### look at moon
```{r}
acc_check(video_time = video_time_7.3[2],
          video_duration = video_duration_07.3.2,
          acc = moon, video = a07.3.2_moon, 
          start = ymd("2022-04-07"), end = ymd("2022-04-09"),
          buffer = 100,
          time_shift = -2*3600, acc_adj = -5, thick = FALSE)
```

##### add acc behav
```{r}
moon <- acc_add_behavior(video_time = video_time_7.3[2],
              video_duration = video_duration_07.3.2,
              acc = moon, video = a07.3.2_moon,
              time_shift = -2*3600, acc_adj = -5)
```


#### look at star
```{r}
acc_check(video_time = video_time_7.3[2],
          video_duration = video_duration_07.3.2,
          acc = star, video = a07.3.2_star, 
          start = ymd("2022-04-07"), end = ymd("2022-04-09"),
          buffer = 100,
          time_shift = -2*3600, acc_adj = -5, thick = FALSE)
```

##### add acc behav
```{r}
star <- acc_add_behavior(video_time = video_time_7.3[2],
              video_duration = video_duration_07.3.2,
              acc = star, video = a07.3.2_star,
              time_shift = -2*3600, acc_adj = -5)
```

#### look at heart
```{r}
acc_check(video_time = video_time_7.3[2],
          video_duration = video_duration_07.3.2,
          acc = heart, video = a07.3.2_heart, 
          start = ymd("2022-04-07"), end = ymd("2022-04-09"),
          buffer = 100,
          time_shift = -2*3600, acc_adj = -5, thick = FALSE)
```
##### add acc behav
```{r}
heart <- acc_add_behavior(video_time = video_time_7.3[2],
              video_duration = video_duration_07.3.2,
              acc = heart, video = a07.3.2_heart,
              time_shift = -2*3600, acc_adj = -5)
```

#### look at bolt
```{r}
acc_check(video_time = video_time_7.3[2],
          video_duration = video_duration_07.3.2,
          acc = bolt, video = a07.3.2_bolt, 
          start = ymd("2022-04-07"), end = ymd("2022-04-09"),
          buffer = 100,
          time_shift = -2*3600, acc_adj = -5, thick = FALSE)
```
##### add acc behav
```{r}
# bolt <- acc_add_behavior(video_time = video_time_7.3[2],
#               video_duration = video_duration_07.3.2,
#               acc = bolt, video = a07.3.2_bolt,
#               time_shift = -2*3600, acc_adj = -5)
```

## 10/04/22
### Part 2
### videos created
```{r}
video_files_10.2 <- list.files(path = "H:/Panama22/FlightCageBocas/Video/100422/Part2/", pattern = ".MP4", full.names = TRUE)

video_time_10.2 <- base::file.info(video_files_10.2)$mtime

tz(video_time_10.2) <- "UTC"
```

#### Part 2.5
```{r}
a10.6.2 <- data.table::fread("../../../../Dropbox/MPI/Dechmann_Lab/Johannes Bernecker/boris_files/ExportedData/updated/100422_6_2.csv", header = TRUE)
paste0(a10.6.2$Behavior, a10.6.2$Subject) %>% table
video_duration_10.6.2 <- a10.6.2$`Total length`[1]

a10.6.2 <- a10.6.2[order(a10.6.2$Subject, a10.6.2$Behavior, a10.6.2$Time),]
a10.6.2_mlt <- data.frame(start = a10.6.2$Time[a10.6.2$Status == "START"],
                          stop = a10.6.2$Time[a10.6.2$Status == "STOP"],
                          behavior = a10.6.2$Behavior[a10.6.2$Status == "START"],
                          subject = a10.6.2$Subject[a10.6.2$Status == "START"])
ggplot(a10.6.2_mlt, aes(x = start, xend = stop, y = behavior, yend = behavior, 
                        col = behavior, group = subject))+
  geom_segment(size = 2)+facet_wrap(~subject)


a10.6.2_bolt <- a10.6.2 %>% filter(Subject == "light bolt")
a10.6.2_moon <- a10.6.2 %>% filter(Subject == "moon")
a10.6.2_heart <- a10.6.2 %>% filter(Subject == "heart")
a10.6.2_star <- a10.6.2 %>% filter(Subject == "star")

```

#### look at moon
```{r}
acc_check(video_time = video_time_10.2[1],
          video_duration = video_duration_10.6.2,
          acc = moon, video = a10.6.2_moon, 
          start = ymd("2022-04-09"), end = ymd("2022-04-11"),
          buffer = 100,
          time_shift = -2*3600, acc_adj = -5, thick = FALSE)
```
##### add acc behav
```{r}
moon <- acc_add_behavior(video_time = video_time_10.2[1],
              video_duration = video_duration_10.6.2,
              acc = moon, video = a10.6.2_moon,
              time_shift = -2*3600, acc_adj = -5)
```

#### look at star
```{r}
acc_check(video_time = video_time_10.2[1],
          video_duration = video_duration_10.6.2,
          acc = star, video = a10.6.2_star, 
          start = ymd("2022-04-09"), end = ymd("2022-04-11"),
          buffer = 100,
          time_shift = -2*3600, acc_adj = -5, thick = FALSE)
```

##### add acc behav
```{r}
star <- acc_add_behavior(video_time = video_time_10.2[1],
              video_duration = video_duration_10.6.2,
              acc = star, video = a10.6.2_star,
              time_shift = -2*3600, acc_adj = -5)
```

#### look at bolt
```{r}
acc_check(video_time = video_time_10.2[1],
          video_duration = video_duration_10.6.2,
          acc = bolt, video = a10.6.2_bolt, 
          start = ymd("2022-04-09"), end = ymd("2022-04-11"),
          buffer = 100,
          time_shift = -2*3600, acc_adj = -5, thick = FALSE)
```

##### add acc behav
```{r}
star <- acc_add_behavior(video_time = video_time_10.2[1],
              video_duration = video_duration_10.6.2,
              acc = star, video = a10.6.2_star,
              time_shift = -2*3600, acc_adj = -5)
```

## 12/04/22
### Part 2
### videos created
```{r}
video_files_12.7 <- list.files(path = "H:/Panama22/FlightCageBocas/Video/120422/Part7/", pattern = ".MP4", full.names = TRUE)

video_time_12.7 <- base::file.info(video_files_12.7)$mtime

tz(video_time_12.7) <- "UTC"
```

#### Part 7.1
```{r}
a12.7.1 <- data.table::fread("../../../../Dropbox/MPI/Dechmann_Lab/Johannes Bernecker/boris_files/ExportedData/updated/120422_7_1.csv", header = TRUE)
paste0(a12.7.1$Behavior, a12.7.1$Subject) %>% table
video_duration_12.7.1 <- a12.7.1$`Total length`[1]

a12.7.1 <- a12.7.1[order(a12.7.1$Subject, a12.7.1$Behavior, a12.7.1$Time),]
a12.7.1_mlt <- data.frame(start = a12.7.1$Time[a12.7.1$Status == "START"],
                          stop = a12.7.1$Time[a12.7.1$Status == "STOP"],
                          behavior = a12.7.1$Behavior[a12.7.1$Status == "START"],
                          subject = a12.7.1$Subject[a12.7.1$Status == "START"])
ggplot(a12.7.1_mlt, aes(x = start, xend = stop, y = behavior, yend = behavior, 
                        col = behavior, group = subject))+
  geom_segment(size = 2)+facet_wrap(~subject)


a12.7.1_bolt <- a12.7.1 %>% filter(Subject == "light bolt")
a12.7.1_moon <- a12.7.1 %>% filter(Subject == "moon")
a12.7.1_heart <- a12.7.1 %>% filter(Subject == "heart")
a12.7.1_star <- a12.7.1 %>% filter(Subject == "star")

```

#### look at moon
```{r}
acc_check(video_time = video_time_12.7[1],
          video_duration = video_duration_12.7.1,
          acc = moon, video = a12.7.1_moon, 
          start = ymd("2022-04-11"), end = ymd("2022-04-14"),
          buffer = 100,
          time_shift = -2*3600, acc_adj = -5, thick = FALSE)
```
##### add acc behav
```{r}
moon <- acc_add_behavior(video_time = video_time_12.7[1],
              video_duration = video_duration_12.7.1,
              acc = moon, video = a12.7.1_moon,
              time_shift = -2*3600, acc_adj = -5)
```

#### look at star
```{r}
acc_check(video_time = video_time_12.7[1],
          video_duration = video_duration_12.7.1,
          acc = moon, video = a12.7.1_moon, 
          start = ymd("2022-04-11"), end = ymd("2022-04-14"),
          buffer = 100,
          time_shift = -2*3600, acc_adj = -5, thick = FALSE)
```

##### add acc behav
```{r}
star <- acc_add_behavior(video_time = video_time_12.7[1],
              video_duration = video_duration_12.7.1,
              acc = star, video = a12.7.1_star,
              time_shift = -2*3600, acc_adj = -5)
```

#### look at heart
```{r}
acc_check(video_time = video_time_12.7[1],
          video_duration = video_duration_12.7.1,
          acc = moon, video = a12.7.1_moon, 
          start = ymd("2022-04-11"), end = ymd("2022-04-14"),
          buffer = 100,
          time_shift = -2*3600, acc_adj = -5, thick = FALSE)
```

##### add acc behav
```{r}
heart <- acc_add_behavior(video_time = video_time_12.7[1],
              video_duration = video_duration_12.7.1,
              acc = heart, video = a12.7.1_heart,
              time_shift = -2*3600, acc_adj = -5)
```

#### look at bolt
```{r}
acc_check(video_time = video_time_12.7[1],
          video_duration = video_duration_12.7.1,
          acc = bolt, video = a12.7.1_moon, 
          start = ymd("2022-04-11"), end = ymd("2022-04-14"),
          buffer = 100,
          time_shift = -2*3600, acc_adj = -5, thick = FALSE)
```

##### add acc behav
```{r}
bolt <- acc_add_behavior(video_time = video_time_12.7[1],
              video_duration = video_duration_12.7.1,
              acc = bolt, video = a12.7.1_bolt,
              time_shift = -2*3600, acc_adj = -5)
```


# save
```{r}
save(moon,heart, star, bolt, file = "../../../../Dropbox/MPI/Phyllostomus/BORIS/boris_video_match.robj")
```

## summarize behaviors
```{r}

star$behavior %>% table()

bolt$behavior %>% table()
```

# random forest
## moon
```{r}

moon$behavior %>% table()

moon.rf <- randomForest(factor(behavior) ~ ODBA + VeDBA + x + y + z + x0 + y0 + z0 + x1 + y1 + z1, 
             data = moon[moon$behavior == "climbing" | moon$behavior == "grooming" | moon$behavior == "sleeping" | 
                           moon$behavior == "flying",])
moon.rf
importance(moon.rf)
varImpPlot(moon.rf)

```

## heart
```{r}
heart$behavior %>% table()
heart.rf <- randomForest(factor(behavior) ~ ODBA + VeDBA + x + y + z + x0 + y0 + z0 + x1 + y1 + z1, 
             data = heart[heart$behavior == "climbing" | heart$behavior == "grooming" | heart$behavior == "sleeping" |
                            heart$behavior == "flying",])
heart.rf
importance(heart.rf)
varImpPlot(heart.rf)
```

## star
```{r}
star$behavior %>% table()
star.rf <- randomForest(factor(behavior) ~ ODBA + VeDBA + x + y + z + x0 + y0 + z0 + x1 + y1 + z1, 
             data = star[star$behavior == "climbing" | star$behavior == "grooming" | star$behavior == "sleeping" |
                            star$behavior == "flying",])
star.rf
importance(star.rf)
varImpPlot(star.rf)
```

## bolt
```{r}
bolt$behavior %>% table()
bolt.rf <- randomForest(factor(behavior) ~ ODBA + VeDBA + x + y + z + x0 + y0 + z0 + x1 + y1 + z1, 
             data = bolt[bolt$behavior == "climbing" | bolt$behavior == "grooming" | bolt$behavior == "sleeping" |
                            bolt$behavior == "flying",])
bolt.rf
importance(bolt.rf)
varImpPlot(bolt.rf)
```

## all bats
```{r}
bats <- rbind(moon[moon$behavior == "climbing" | moon$behavior == "grooming" | moon$behavior == "sleeping" |
                            moon$behavior == "flying",],
              heart[heart$behavior == "climbing" | heart$behavior == "grooming" | heart$behavior == "sleeping" |
                            heart$behavior == "flying",],
              star[star$behavior == "climbing" | star$behavior == "grooming" | star$behavior == "sleeping" |
                            star$behavior == "flying",],
              bolt[bolt$behavior == "climbing" | bolt$behavior == "grooming" | bolt$behavior == "sleeping" |
                            bolt$behavior == "flying",])
fc.rf <- randomForest(factor(behavior) ~ ODBA + VeDBA + x + y + z + x0 + y0 + z0 + x1 + y1 + z1, 
             data = bats)
```



## save models
```{r}
save(moon.rf, heart.rf, star.rf, bolt.rf, file = "../../../../Dropbox/MPI/Phyllostomus/BORIS/rf_fc_bats.robj")
```

# predict data on to each bat
# heart
```{r}
#heart$heart_behav <- predict(heart.rf, newdata = heart)
(table(heart$heart_behav)/nrow(heart)) %>% round(2)

#heart$moon_behav <- predict(moon.rf, newdata = heart)
(table(heart$moon_behav)/nrow(heart)) %>% round(2)

#heart$bolt_behav <- predict(bolt.rf, newdata = heart)
(table(heart$heart_behav)/nrow(heart)) %>% round(2)

#heart$star_behav <- predict(star.rf, newdata = heart)
(table(heart$star_behav)/nrow(heart)) %>% round(2)
```


# star
```{r}
star$heart_behav <- predict(heart.rf, newdata = star)
(table(star$heart_behav)/nrow(star)) %>% round(2)

star$moon_behav <- predict(moon.rf, newdata = star)
(table(star$moon_behav)/nrow(star)) %>% round(2)

star$bolt_behav <- predict(bolt.rf, newdata = star)
(table(star$heart_behav)/nrow(star)) %>% round(2)

star$star_behav <- predict(star.rf, newdata = star)
(table(star$star_behav)/nrow(star)) %>% round(2)
```

# moon
```{r}
moon$heart_behav <- predict(heart.rf, newdata = moon)
(table(moon$heart_behav)/nrow(moon)) %>% round(2)

moon$moon_behav <- predict(moon.rf, newdata = moon)
(table(moon$moon_behav)/nrow(moon)) %>% round(2)

moon$bolt_behav <- predict(bolt.rf, newdata = moon)
(table(moon$heart_behav)/nrow(moon)) %>% round(2)

moon$star_behav <- predict(star.rf, newdata = moon)
(table(moon$star_behav)/nrow(moon)) %>% round(2)
```

# bolt
```{r}
bolt$heart_behav <- predict(heart.rf, newdata = bolt)
(table(bolt$heart_behav)/nrow(bolt)) %>% round(2)

bolt$moon_behav <- predict(moon.rf, newdata = bolt)
(table(bolt$moon_behav)/nrow(bolt)) %>% round(2)

bolt$bolt_behav <- predict(bolt.rf, newdata = bolt)
(table(bolt$heart_behav)/nrow(bolt)) %>% round(2)

bolt$star_behav <- predict(star.rf, newdata = bolt)
(table(bolt$star_behav)/nrow(bolt)) %>% round(2)
```

```{r}
# what is the significance of the behavior match?
t <- with(heart[heart$behavior == "climbing" | heart$behavior == "grooming" | heart$behavior == "sleeping" |
                            heart$behavior == "flying",], table(behavior, moon_behav))
t
# this calculates association statistics between pairs of bats
a <- assocstats(t)
a
```


```{r}
heart1s <- heart[seq(1,nrow(heart), by = 25),]
moon1s <- moon[seq(1,nrow(moon), by = 25),]
star1s <- star[seq(1,nrow(star), by = 25),]
bolt1s <- bolt[seq(1,nrow(bolt), by = 25),]

plot(heart1s$time, heart1s$VeDBA, col = heart1s$behavior %>% factor)
plot(heart1s$time, heart1s$VeDBA, col = heart1s$heart_behav %>% factor)

```

```{r}
save(heart1s, moon1s, star1s, bolt1s, file = "../../../../Dropbox/MPI/Dechmann_Lab/Johannes Bernecker/thin_fc_bats.robj")

```


